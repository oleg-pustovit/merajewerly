{% doc %}
  This snippet is used to display the add to cart button.
  Intended for add-to-cart.liquid block.

  @param {string} can_add_to_cart - Whether the product can be added to the cart
  @param {string} add_to_cart_text - The text of the add to cart button
  @param {string} product - The product to add to the cart
  @param {string} icon_only_on_mobile - Whether the icon is only visible on mobile
  @param {string} text_only_on_mobile - Whether the text is only visible on mobile
  @param {string} class - The class of the button
{% enddoc %}

{% stylesheet %}
  .add-to-cart-text {
    display: flex;
    gap: var(--gap-2xs);
    align-items: center;
    justify-content: center;
    animation-duration: var(--animation-speed);
    animation-timing-function: var(--animation-easing);
    animation-fill-mode: forwards;
    transition: opacity var(--animation-speed) var(--animation-easing);
  }

  .atc-added .add-to-cart-text {
    animation-name: atc-slide-out;
  }

  .add-to-cart-text--added {
    position: absolute;
    inset: 0;
    animation-duration: var(--animation-speed);
    animation-timing-function: var(--animation-easing);
    animation-fill-mode: forwards;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: width var(--animation-speed) var(--animation-easing),
      opacity var(--animation-speed) var(--animation-easing);
  }

  .atc-added .add-to-cart-text--added {
    animation-name: atc-slide-in;
  }

  add-to-cart-component{
    display: flex;
    flex-direction: column;
    gap: 16px;
    width: 100%;
  }

  @keyframes atc-slide-in {
    from {
      opacity: 0;
      transform: translateY(0.5em);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes atc-slide-out {
    from {
      transform: translateY(0);
      opacity: 1;
    }

    to {
      transform: translateY(-1em);
      opacity: 0;
    }
  }
{% endstylesheet %}

{% doc %}
  @prompt
    In stock/Out of stock block. Just small green icon (if product is in stock) with text that says "In stock - ready to ship" , Add ability to change the icon for In stock and out of stock. I should be able to upload SVG icon and select its sizes. 
    

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-stock-indicator-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: {{ block.settings.text_size }}px;
    font-weight: {{ block.settings.text_weight }};
    margin-top: {{ block.settings.margin_top }}px;
    margin-bottom: {{ block.settings.margin_bottom }}px;
  }

  .ai-stock-indicator-icon-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    justify-content: center;
    width: {{ block.settings.icon_size }}px;
    height: {{ block.settings.icon_size }}px;
  }

  .ai-stock-indicator-icon-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
  }

  .ai-stock-indicator-in-stock-{{ ai_gen_id }} {
    color: {{ block.settings.in_stock_text_color }};
  }

  .ai-stock-indicator-out-of-stock-{{ ai_gen_id }} {
    color: {{ block.settings.out_of_stock_text_color }};
  }
  
  .ai-stock-indicator-default-icon-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    border-radius: 50%;
  }
  
  .ai-stock-indicator-in-stock-{{ ai_gen_id }} .ai-stock-indicator-default-icon-{{ ai_gen_id }} {
    background-color: {{ block.settings.in_stock_color }};
  }
  
  .ai-stock-indicator-out-of-stock-{{ ai_gen_id }} .ai-stock-indicator-default-icon-{{ ai_gen_id }} {
    background-color: {{ block.settings.out_of_stock_color }};
  }
  
  .ai-stock-indicator-default-icon-{{ ai_gen_id }} svg {
    width: 60%;
    height: 60%;
  }

  .indic-avaible-stock.avaible{
    .avaibleIconStock{
      display: block;
    }

    .avaibleIconStockTxt{
      display: inline-block;
    }

    .nonavaibleIconStock{
      display: none;
    }

    .nonavaibleIconStockTxt{
      display: none;
    }
  }

  .indic-avaible-stock.nonavaible{
    .avaibleIconStock{
      display: none;
    }

    .avaibleIconStockTxt{
      display: none;
    }

    .nonavaibleIconStock{
      display: block;
    }

    .nonavaibleIconStockTxt{
      display: inline-block;
    }
  }
{% endstyle %}

{%- liquid
  assign default_add_to_cart_text = 'actions.add_to_cart' | t
  assign product_variant_media = product.selected_or_first_available_variant.featured_media.preview_image | image_url: width: 100, crop: center
  if product.selected_or_first_available_variant.featured_media.preview_image == blank
    assign product_variant_media = product.featured_media.preview_image | image_url: width: 100, crop: center
  endif
-%}

<add-to-cart-component
  ref="addToCartButtonContainer"
  data-product-variant-media="{{ product_variant_media }}"
>
  {% if template == 'product' %}
  <div 
    class="indic-avaible-stock ai-stock-indicator-{{ ai_gen_id }} {% if product.available %}ai-stock-indicator-in-stock-{{ ai_gen_id }}{% else %}ai-stock-indicator-out-of-stock-{{ ai_gen_id }}{% endif %} {% if product.selected_or_first_available_variant.avaible %}avaible{% else %}nonavaible{% endif %}"
    {{ block.shopify_attributes }}
  >
    <div class="ai-stock-indicator-icon-{{ ai_gen_id }}">
      {% if block.settings.custom_in_stock_icon %}
        <img 
          src="{{ block.settings.custom_in_stock_icon | img_url: 'master' }}" 
          class="avaibleIconStock"
          alt="In stock" 
          width="{{ block.settings.icon_size }}" 
          height="{{ block.settings.icon_size }}"
          loading="lazy"
        >
      {% else %}
        <div class="ai-stock-indicator-default-icon-{{ ai_gen_id }} avaibleIconStockTxt">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
      {% endif %}
      {% if block.settings.custom_out_of_stock_icon %}
        <img 
          src="{{ block.settings.custom_out_of_stock_icon | img_url: 'master' }}" 
          class="nonavaibleIconStock"
          alt="Out of stock" 
          width="{{ block.settings.icon_size }}" 
          height="{{ block.settings.icon_size }}"
          loading="lazy"
        >
      {% else %}
        <div class="ai-stock-indicator-default-icon-{{ ai_gen_id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </div>
      {% endif %}
    </div>
    <span class="avaibleIconStockTxt">
      {{ block.settings.in_stock_text }}
    </span>
    <span class="nonavaibleIconStockTxt">
      {{ block.settings.out_of_stock_text }}
    </span>
  </div>
  {% endif %}
  <button
    id="{{ id }}"
    type="submit"
    name="add"
    ref="addToCartButton"
    on:click="/handleClick"
    class="button {{ class }}"
    {% unless can_add_to_cart %}
    style="display: none"
      disabled
    {% endunless %}
  >
    <span
      class="add-to-cart-text"
    >
      {% if can_add_to_cart %}
        <span class="svg-wrapper add-to-cart-icon{% if text_only_on_mobile %} is-visually-hidden-mobile{% endif %}">
          {{- 'icon-add-to-cart.svg' | inline_asset_content -}}
        </span>
      {% endif %}
      <span class="add-to-cart-text__content{% if icon_only_on_mobile %} is-visually-hidden-mobile{% endif %}">
        {{- add_to_cart_text | default: default_add_to_cart_text -}}
      </span>
    </span>
    <span
      aria-hidden="true"
      class="add-to-cart-text--added"
    >
      <span class="svg-wrapper add-to-cart-icon--added">
        {{- 'icon-checkmark.svg' | inline_asset_content -}}
      </span>
      <span class="{% if icon_only_on_mobile %}is-visually-hidden-mobile{% endif %}">
        {{- 'actions.added' | t -}}
      </span>
    </span>
  </button>
</add-to-cart-component>
