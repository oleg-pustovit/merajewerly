{% doc %}
  @prompt
    In stock/Out of stock block. Just small green icon (if product is in stock) with text that says "In stock - ready to ship" , Add ability to change the icon for In stock and out of stock. I should be able to upload SVG icon and select its sizes. 
    

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-stock-indicator-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: {{ block.settings.text_size }}px;
    font-weight: {{ block.settings.text_weight }};
    margin-top: {{ block.settings.margin_top }}px;
    margin-bottom: {{ block.settings.margin_bottom }}px;
  }

  .ai-stock-indicator-icon-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    justify-content: center;
    width: {{ block.settings.icon_size }}px;
    height: {{ block.settings.icon_size }}px;
  }

  .ai-stock-indicator-icon-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
  }

  .ai-stock-indicator-in-stock-{{ ai_gen_id }} {
    color: {{ block.settings.in_stock_text_color }};
  }

  .ai-stock-indicator-out-of-stock-{{ ai_gen_id }} {
    color: {{ block.settings.out_of_stock_text_color }};
  }
  
  .ai-stock-indicator-default-icon-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    border-radius: 50%;
  }
  
  .ai-stock-indicator-in-stock-{{ ai_gen_id }} .ai-stock-indicator-default-icon-{{ ai_gen_id }} {
    background-color: {{ block.settings.in_stock_color }};
  }
  
  .ai-stock-indicator-out-of-stock-{{ ai_gen_id }} .ai-stock-indicator-default-icon-{{ ai_gen_id }} {
    background-color: {{ block.settings.out_of_stock_color }};
  }
  
  .ai-stock-indicator-default-icon-{{ ai_gen_id }} svg {
    width: 60%;
    height: 60%;
  }
{% endstyle %}

<div 
  class="ai-stock-indicator-{{ ai_gen_id }} {% if product.available %}ai-stock-indicator-in-stock-{{ ai_gen_id }}{% else %}ai-stock-indicator-out-of-stock-{{ ai_gen_id }}{% endif %}"
  {{ block.shopify_attributes }}
>
  <div class="ai-stock-indicator-icon-{{ ai_gen_id }}">
    {% if product.available %}
      {% if block.settings.custom_in_stock_icon %}
        <img 
          src="{{ block.settings.custom_in_stock_icon | img_url: 'master' }}" 
          alt="In stock" 
          width="{{ block.settings.icon_size }}" 
          height="{{ block.settings.icon_size }}"
          loading="lazy"
        >
      {% else %}
        <div class="ai-stock-indicator-default-icon-{{ ai_gen_id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
      {% endif %}
    {% else %}
      {% if block.settings.custom_out_of_stock_icon %}
        <img 
          src="{{ block.settings.custom_out_of_stock_icon | img_url: 'master' }}" 
          alt="Out of stock" 
          width="{{ block.settings.icon_size }}" 
          height="{{ block.settings.icon_size }}"
          loading="lazy"
        >
      {% else %}
        <div class="ai-stock-indicator-default-icon-{{ ai_gen_id }}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </div>
      {% endif %}
    {% endif %}
  </div>
  <span>
    {% if product.available %}
      {{ block.settings.in_stock_text }}
    {% else %}
      {{ block.settings.out_of_stock_text }}
    {% endif %}
  </span>
</div>

{% schema %}
{
  "name": "Stock Indicator",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Text Settings"
    },
    {
      "type": "text",
      "id": "in_stock_text",
      "label": "In stock text",
      "default": "In stock - ready to ship"
    },
    {
      "type": "text",
      "id": "out_of_stock_text",
      "label": "Out of stock text",
      "default": "Out of stock"
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 14
    },
    {
      "type": "select",
      "id": "text_weight",
      "label": "Text weight",
      "options": [
        {
          "value": "400",
          "label": "Regular"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semibold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "500"
    },
    {
      "type": "header",
      "content": "Icon Settings"
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 12,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Icon size",
      "default": 16
    },
    {
      "type": "header",
      "content": "In Stock Appearance"
    },
    {
      "type": "image_picker",
      "id": "custom_in_stock_icon",
      "label": "Custom in stock icon (SVG recommended)"
    },
    {
      "type": "color",
      "id": "in_stock_color",
      "label": "Default icon background color",
      "default": "#008060",
      "info": "Used when no custom icon is uploaded"
    },
    {
      "type": "color",
      "id": "in_stock_text_color",
      "label": "Text color",
      "default": "#008060"
    },
    {
      "type": "header",
      "content": "Out of Stock Appearance"
    },
    {
      "type": "image_picker",
      "id": "custom_out_of_stock_icon",
      "label": "Custom out of stock icon (SVG recommended)"
    },
    {
      "type": "color",
      "id": "out_of_stock_color",
      "label": "Default icon background color",
      "default": "#D82C0D",
      "info": "Used when no custom icon is uploaded"
    },
    {
      "type": "color",
      "id": "out_of_stock_text_color",
      "label": "Text color",
      "default": "#D82C0D"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Margin top",
      "default": 8
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Margin bottom",
      "default": 8
    }
  ],
  "presets": [
    {
      "name": "Stock Indicator"
    }
  ]
}
{% endschema %}